(function(){tinymce.create("tinymce.plugins.Trailing",{init:function(a,b){var c=this;a.onSetContent.add(function(d,e){c._insertTrailingElement(d)});a.onNodeChange.add(function(f,d,g){c._insertTrailingElement(f)});a.onBeforeGetContent.add(function(d,e){c._removeTrailingElement(d)})},getInfo:function(){return{longname:"Trailing Element Fix (based on EditorEnhancements by tan@enonic.com)",author:"susanne.tober@uibk.ac.at",authorurl:"http://www.uibk.ac.at/zid/mitarbeiter/c10209.html",infourl:"http://www.uibk.ac.at/zid/systeme/xims",version:"1.0"}},_insertTrailingElement:function(b){var a=b.getBody();var d=a&&a.lastChild;if(!a||!d){return}try{if(d.nodeType==1&&needsSpace(d.nodeName.toLowerCase())&&(!d.innerHTML.match(/^(\s|<br\s*\/?>|&nbsp;)*$/i)||!d.firstChild)){a.appendChild(b.dom.create("p",{},"test<br/>"))}}catch(c){if(typeof(console)=="object"&&console.error){console.error("TrailingPlugin._insertTrailingElement (ignored) : "+c)}}},_removeTrailingElement:function(c){var b=c.getBody();if(!b){return}var f,d=1,g,a=1;try{while((f=b.lastChild)&&f.nodeType==1&&f.nodeName.toLowerCase()=="p"&&f.innerHTML.match(/^(\s|<br\s*\/?>|test&nbsp;)*$/i)){b.removeChild(f);if(d--<1){break}}}catch(e){if(typeof(console)=="object"&&console.error){console.error("TrailingPlugin._removeTrailingElement (ignored) : "+e)}}}});tinymce.PluginManager.add("trailing",tinymce.plugins.Trailing)})();