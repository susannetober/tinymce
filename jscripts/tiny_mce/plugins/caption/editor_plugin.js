(function(){tinymce.PluginManager.requireLangPack('caption');tinymce.create('tinymce.plugins.CaptionPlugin',{init:function(ed,url){ed.addCommand('mceCaption',function(){if(ed.dom.getAttrib(ed.selection.getNode(),'class').indexOf('mceItem')!=-1)return;ed.windowManager.open({file:url+'/caption.htm',width:480,height:230,inline:1},{plugin_url:url});});ed.addButton('caption',{title:'caption.desc',cmd:'mceCaption'});ed.onNodeChange.add(function(ed,cm,n){cm.setActive('caption',n.nodeName=='IMG');});},getInfo:function(){return{longname:'Image Caption',author:'Susanne Tober',authorurl:'http://www.uibk.ac.at/zid/',infourl:'http://www.uibk.ac.at/zid/systeme/xims/',version:tinymce.majorVersion+"."+tinymce.minorVersion};},updateCaption:function(ed){var settings={wrapperElement:'div',wrapperClass:'caption',captionElement:'p',imageAttr:'alt',requireText:true,copyStyle:true,removeStyle:true,removeAlign:true,copyAlignmentToClass:false,copyFloatToClass:true,autoWidth:true};var image=$(ed.selection.getNode());var parent=$(image).parent();if(parent&&parent.is('div')){parent.attr('style',image.attr('style'));parent.width(image.width());parent.height('');if(settings.removeStyle)image.removeAttr('style');if(settings.removeAlign)image.removeAttr('align');parent.removeAttr('_mce_style');image.removeAttr('_mce_style');}return;}},function removeCaption(ed){var image=$(ed.selection.getNode());var parent=$(image).parent();while(!parent.hasClass('caption')){parent=parent.parent();}style=parent.attr('style');style=style.substr(0,style.indexOf('width')-1);image.attr('style',style);image.unwrap();});tinymce.PluginManager.add('caption',tinymce.plugins.CaptionPlugin);})();